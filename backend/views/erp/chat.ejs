<div id="frame">
    <div id="sidepanel">
        <div id="profile">
            <div class="wrap">
                <img id="profile-img" src="" class="online" alt="" />
                <p>Mike Ross</p>
            </div>
        </div>
        <div id="search">
            <label for="">
                <i class="fa fa-search" aria-hidden="true"></i>
            </label>
            <input type="text" placeholder="Search contacts..." />
        </div>
        <div id="contacts">
            <ul id="chat_chatList">
                <li class="contact">
                    <div class="wrap">
                        <span class="contact-status online"></span>
                        <img src="http://emilcarlsson.se/assets/louislitt.png" alt="" />
                        <div class="meta">
                            <p class="name">Louis Litt</p>
                            <p class="preview">You just got LITT up, Mike.</p>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
        <div id="bottom-bar">
            <button id="addcontact">
                <i class="fa fa-user-plus fa-fw" aria-hidden="true"></i>
                <span>Add contact</span>
            </button>
            <button id="settings">
                <i class="fa fa-cog fa-fw" aria-hidden="true"></i>
                <span>Settings</span>
            </button>
        </div>
    </div>
    <div class="content" style="display: none;" id="chat_content">
        <div class="contact-profile">
            <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
            <p id="chat_user_nickname">Harvey Specter</p>
        </div>
        <div class="messages">
            <ul id="chat_message_list">
                <li class="sent">
                    <p>How the hell am I supposed to get a jury to believe you when I am not even sure that I do?!</p>
                </li>
                <li class="replies">
                    <p>When you're backed against the wall, break the god damn thing down.</p>
                </li>
                <li class="replies">
                    <p>Excuses don't win championships.</p>
                </li>
                <li class="sent">
                    <p>Oh yeah, did Michael Jordan tell you that?</p>
                </li>
                <li class="replies">
                    <p>No, I told him that.</p>
                </li>
                <li class="replies">
                    <p>What are your choices when someone puts a gun to your head?</p>
                </li>
                <li class="sent">
                    <p>What are you talking about? You do what they say or they shoot you.</p>
                </li>
                <li class="replies">
                    <p>Wrong. You take the gun, or you pull out a bigger one. Or, you call their bluff. Or, you do any
                        one of
                        a hundred and forty six other things.</p>
                </li>
            </ul>
        </div>
        <div class="message-input">
            <div class="wrap">
                <input type="text" placeholder="Write your message..." />
                <i class="fa fa-paperclip attachment" aria-hidden="true"></i>
                <button class="submit">
                    <i class="fa fa-paper-plane" aria-hidden="true"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    var mSelected_user_idx;
    $(document).on('click', '.contact', function (e) {
        var user_idx = $(this).find('.hide-user-idx').html()
        var user_nickname = $(this).find('.name').html()
        console.log(user_idx);
        console.log(user_nickname);
        mSelected_user_idx = user_idx;

        $.ajax({
            url: "/erp/chat/json/getChat",
            method: "POST",
            data: { user_idx: user_idx },
            success: function (data) {

                $('#chat_user_nickname').html(user_nickname);
                $('#chat_message_list').html("");
                console.log(data);

                for (var i = 0; i < data.list.length; i++) {
                    var chat = data.list[i];
                    newMessage(parseInt(chat.type), chat.message);
                }

                $('#chat_content').css("display", "block");
            }
        });
    });

    $(document).ready(function () {
        $.ajax({
            url: "/erp/chat/json/getChatList",
            method: "POST",
            data: {},
            success: function (data) {
                console.log(data);
                $('#chat_chatList').html('');
                for (var i = 0; i < data.list.length; i++) {
                    var chat = data.list[i];
                    $('#chat_chatList').append(
                        '<li class="contact">' +
                        '<span class="hide-user-idx" style="display:none">' + chat.user_idx + '</span>' +
                        '<div class="wrap">' +
                        '<span class="contact-status online"></span>' +
                        '<img src="" alt="" />' +
                        '<div class="meta">' +
                        '<p class="name">' + chat.nickname + '</p>' +
                        '<p class="preview">' + chat.message + '</p>' +
                        '</div></div></li>'
                    )
                }


            }
        });


    });
</script>